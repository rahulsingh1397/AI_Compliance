{% extends "base.html" %}

{% block title %}{{ gettext('Risk Overview') }} - {{ super() }}{% endblock %}

{% block content %}
<!-- Main Header -->
<div class="main-header">
    <h1 class="page-title">{{ title }}</h1>
    <div class="header-actions">
        <button class="btn list-action-btn"><i class="fas fa-calendar-alt me-1"></i> {{ gettext('Last 30 Days') }}</button>
        <button class="btn create-btn">{{ gettext('Export Summary') }}</button>
    </div>
</div>

<div class="row">
    <div class="col-lg-8">
        <div class="chart-wrapper">
            <div class="list-header">
                <h4><i class="fas fa-chart-line me-2"></i>{{ gettext('Risk Trend') }}</h4>
            </div>
            <div class="chart-body">
                <canvas id="riskTrendChart"></canvas>
            </div>
        </div>
    </div>
    <div class="col-lg-4">
        <div class="content-list-wrapper">
            <div class="list-header">
                <h4><i class="fas fa-shield-alt me-2"></i>{{ gettext('Overall Risk Score') }}</h4>
            </div>
            <div class="risk-score-card">
                <div class="risk-score {{ overall_risk.level.lower() }}">{{ overall_risk.score }}</div>
                <div class="risk-level">{{ overall_risk.level }}</div>
                <p class="risk-description">{{ overall_risk.description }}</p>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    {% for category in risk_categories %}
    <div class="col-md-6 col-lg-4 mb-4">
        <div class="content-list-wrapper h-100">
            <div class="list-header">
                <h4>{{ category.name }}</h4>
                <span class="risk-score-small {{ category.level.lower() }}">{{ category.score }}</span>
            </div>
            <div class="risk-category-body">
                <p>{{ category.description }}</p>
                <ul class="risk-factors-list">
                    {% for factor in category.factors %}
                    <li>{{ factor }}</li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const riskTrendCtx = document.getElementById('riskTrendChart');
    if (riskTrendCtx) {
        new Chart(riskTrendCtx, {
            type: 'line',
            data: {
                labels: {{ risk_trend.labels | tojson }},
                datasets: [{
                    label: '{{ gettext("Risk Score Over Time") }}',
                    data: {{ risk_trend.data | tojson }},
                    borderColor: '#dc3545',
                    backgroundColor: 'rgba(220, 53, 69, 0.1)',
                    fill: true,
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    }
});
</script>
{% endblock %}
